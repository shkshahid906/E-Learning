{% extends 'base.html' %}
{% block title %}Manage Students - StudyNode{% endblock %}

{% block content %}
<style>
  .stud {
    margin: 6% 17%;
  }
  button {
    background: red;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: darkred;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 20px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: left;
  }
  th {
    background-color: #f0a500;
    color: #fff;
  }
</style>

<div class="stud">
  <h2>ðŸŽ“ Student Management</h2>

  <form method="GET" action="{{ url_for('admin_manage_students') }}">
    <input type="text" name="search" placeholder="Search by name or username..." value="{{ request.args.get('search', '') }}">
    <button type="submit">Search</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>ID</th><th>Name</th><th>Username</th><th>Email</th><th>Joined</th><th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for s in students %}
      <tr id="row-{{ s.ID }}">
        <td>{{ s.ID }}</td>
        <td>{{ s.Name }}</td>
        <td>{{ s.Username }}</td>
        <td>{{ s.Email }}</td>
        <td>{{ s.Registration_date.strftime('%Y-%m-%d') }}</td>
        <td>
          <button onclick="deleteUser({{ s.ID }})">Delete</button>
        </td>
      </tr>
      {% endfor %}
      {% if students|length == 0 %}
      <tr><td colspan="6" style="text-align:center;">No students found.</td></tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}

{% block scripts %}
<script>
  function deleteUser(userId) {
  if (!confirm('Are you sure you want to delete this student?')) return;

  fetch(`/admin/delete/${userId}`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
  })
  .then(response => {
    console.log('Response status:', response.status);
    if (response.ok) {
      alert("Student deleted successfully");
      const row = document.getElementById('row-' + userId);
      if(row) row.remove();
    } else {
      response.json().then(data => {
        alert("Failed to delete student: " + (data.message || "Unknown error"));
      });
    }
  })
  .catch(error => {
    console.error('Fetch error:', error);
    alert('An error occurred while deleting student.');
  });
}

</script>
{% endblock %}
